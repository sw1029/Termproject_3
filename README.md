# Termproject_3

> **Goal**  
> - 5ì¢… ì •ë³´(í•™ì‚¬ì¼ì •Â·ê³µì§€ì‚¬í•­Â·ì…”í‹€ë²„ìŠ¤Â·ì¡¸ì—…ìš”ê±´Â·ì‹ë‹¨)ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ **í¬ë¡¤ë§**  
> - **LLM 0-4 ë¶„ë¥˜ê¸° + RAG íŒŒì´í”„ë¼ì¸**ìœ¼ë¡œ ì‹¤ì‹œê°„ Q&A ì œê³µ  
> - Flask web ui/CLI/REST ì„¸ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ ì§€ì›  

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

> ì˜¤ë¥¸ìª½ `# ---` ì£¼ì„ì€ **ê° íŒŒì¼ì˜ í•µì‹¬ ì—­í• **ì…ë‹ˆë‹¤.

```text
Termproject_{3}/
â”œâ”€â”€ data/                                # í…ŒìŠ¤íŠ¸Â·ì›ë³¸Â·ìºì‹œ ë°ì´í„° ì €ì¥
â”‚   â”œâ”€â”€ test_cls.json             # --- 0~4 ë¶„ë¥˜ê¸° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸Â·ì •ë‹µ ì„¸íŠ¸
â”‚   â”œâ”€â”€ test_chat.json            # --- ì±—ë´‡ E2E í…ŒìŠ¤íŠ¸ ì§ˆë¬¸Â·ì •ë‹µ ì„¸íŠ¸
â”‚   â””â”€â”€ raw/                      # --- í¬ë¡¤ë§ ì›ë³¸ HTML/PDF/CSV ì¼ìë³„ ìŠ¤ëƒ…ìƒ·
â”‚
â”œâ”€â”€ src/                                 # ì• í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ classifier.ipynb         *# --- LLM ë¶„ë¥˜ê¸° ì‹¤í—˜Â·íŒŒì¸íŠœë‹Â·ONNX ì¶”ì¶œ ë…¸íŠ¸ë¶
â”‚   â”œâ”€â”€ chatbot_ui.py            *# --- Flask ê¸°ë°˜ web UI: ì‹¤ì‹œê°„ ëŒ€í™” + ì‹œê°í™”
â”‚   â”œâ”€â”€ realtime_model.py        *# --- FastAPI ì„œë²„: ë¶„ë¥˜â†’RAGâ†’ì‘ë‹µ REST ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ crawlers/                        # í•­ëª©ë³„ í¬ë¡¤ëŸ¬ 5ì¢…
â”‚   â”‚   â”œâ”€â”€ __init__.py          # --- íŒ¨í‚¤ì§€ ì´ˆê¸°í™”
â”‚   â”‚   â”œâ”€â”€ academic_calendar.py # --- plus.cnu.ac.kr í•™ì‚¬ì¼ì • HTML/PDF íŒŒì‹±
â”‚   â”‚   â”œâ”€â”€ notices.py           # --- í•™ê³¼Â·ëŒ€í•™ ê³µì§€ì‚¬í•­ links.txt ê¸°ë°˜ í¬ë¡¤ë§
â”‚   â”‚   â”œâ”€â”€ shuttle_bus.py       # --- ì…”í‹€ë²„ìŠ¤ ì‹œê°„í‘œÂ·ë³€ê²½ ê³µì§€ ìˆ˜ì§‘
â”‚   â”‚   â”œâ”€â”€ graduation_req.py    # --- ì¡¸ì—…ìš”ê±´ í˜ì´ì§€/ë¬¸ì„œ ìŠ¤í¬ë˜í•‘
â”‚   â”‚   â””â”€â”€ meals.py             # --- í•™ì‹Â·êµì§ì› ì‹ë‹¨í‘œ í¬ë¡¤ë§
â”‚   â”‚
â”‚   â”œâ”€â”€ retrieval/                       # ê²€ìƒ‰Â·ì¸ë±ì‹±Â·í”„ë¡¬í”„íŠ¸ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ build_index.py       # --- FAISS/Qdrant + BM25 ì¸ë±ìŠ¤ (batch upsert)
â”‚   â”‚   â””â”€â”€ rag_pipeline.py      # --- Hybrid Search + í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ì˜
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py            # --- ê²½ë¡œÂ·DBÂ·API í‚¤ í™˜ê²½ì„¤ì • ë¡œë”
â”‚   â”‚   â””â”€â”€ logger.py            # --- loguru ê¸°ë°˜ í‘œì¤€ ë¡œê¹… ì„¤ì •
â”‚   â”‚
â”‚   â”œâ”€â”€ evaluation/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ evaluate_rag.py      # --- Ragas recall/faithfulness ë©”íŠ¸ë¦­ ê³„ì‚°
â”‚   â”‚
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ webui/                              # Flaskâ€‘SocketIO ì±„íŒ… UI
â”‚   â”œâ”€â”€ app.py                 # --- ì‹¤ì‹œê°„ ì±„íŒ… ì›¹ ì„œë²„
â”‚   â”œâ”€â”€ templates/index.html   # --- ê¸°ë³¸ ì±„íŒ… ì°½ í…œí”Œë¦¿
â”‚   â””â”€â”€ static/                # --- JS/CSS ì •ì  ë¦¬ì†ŒìŠ¤
â”‚
â”œâ”€â”€ model/
â”‚   â””â”€â”€ model.bin               *# --- ì„ë² ë”©(ì˜ˆ: KoE5) íŒŒì¸íŠœë‹ ê°€ì¤‘ì¹˜
â”‚
â”œâ”€â”€ outputs/                             # ì‹¤í–‰ ì¤‘ ìƒì„±ëœ ê²°ê³¼ ë° ë¡œê·¸
â”‚   â”œâ”€â”€ cls_output.json          *# --- ë¶„ë¥˜ê¸° ì¶”ë¡  ê²°ê³¼ ìƒ˜í”Œ(log)
â”‚   â”œâ”€â”€ chat_output.json         *# --- ì±—ë´‡ ë°ëª¨ ì„¸ì…˜ ë¡œê·¸
â”‚   â””â”€â”€ realtime_output.json     *# --- ì‹¤ì‹œê°„ API ì¸ì…/ì‘ë‹µ ê¸°ë¡
â”‚
â”œâ”€â”€ chatbot.sh                   *# --- ì „ì²´ íŒŒì´í”„ë¼ì¸(í¬ë¡¤ëŸ¬â†’ì¸ë±ìŠ¤â†’API) êµ¬ë™ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt             *# --- Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ëª©ë¡
â””â”€â”€ README.md                    *# --- (í˜„ì¬ ë¬¸ì„œ)



# ğŸ“š íŒŒì¼ë³„ ìƒì„¸ ì„¤ê³„ â€” ì—­í• ê³¼ í•µì‹¬ êµ¬ì„±ìš”ì†Œ(í•¨ìˆ˜Â·í´ë˜ìŠ¤)

ì´ ë¬¸ì„œëŠ” **Termproject_{ì¡°}** ì €ì¥ì†Œì˜ ê° í•­ëª©ì´ â€œë¬´ì—‡ì„, ì–´ë–»ê²Œâ€ ë‹´ë‹¹í•˜ëŠ”ì§€ë¥¼  
**ìì—°ì–´**ë¡œ ìƒì„¸íˆ ê¸°ìˆ í•©ë‹ˆë‹¤. ì‹¤ì œ êµ¬í˜„ ì‹œ í•¨ìˆ˜/í´ë˜ìŠ¤ ì‹œê·¸ë‹ˆì²˜ëŠ” ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë‚˜,  
ì „ì²´ íë¦„Â·ëª¨ë“ˆ ê²½ê³„Â·ì˜ì¡´ ê´€ê³„ë¥¼ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

---

## 1. `data/`

| íŒŒì¼(í´ë”) | ì—­í•  | ë‚´ë¶€ ë‚´ìš© |
|------------|------|-----------|
| `test_cls.json` | LLM 0-4 **ë¶„ë¥˜ê¸° ë‹¨ìœ„ì‹œí—˜** ë°ì´í„° | `{ "question": "...", "label": 2 }` í˜•íƒœì˜ JSONL |
| `test_chat.json` | ì±—ë´‡ **E2E ì‹œë‚˜ë¦¬ì˜¤** | `{"user":"...", "expected":"..."}`  |
| `raw/` | **í¬ë¡¤ë§ ì›ë³¸ ìŠ¤ëƒ…ìƒ·** ì €ì¥ì†Œ | `<YYYYMMDD>/academic.html`, `â€¦/meals.csv` ë“± |

---

## 2. `src/`

### 2-1. ìµœìƒìœ„ ìŠ¤í¬ë¦½íŠ¸Â·ë…¸íŠ¸ë¶

| íŒŒì¼ | ì£¼ìš” í´ë˜ìŠ¤/í•¨ìˆ˜ | ì„¤ëª… |
|------|-----------------|------|
| **`classifier.ipynb`** | - `train_classifier()`<br>- `evaluate()`<br>- `export_onnx()` | âœ… **ë…¸íŠ¸ë¶**<br>1) ì‚¬ì „í•™ìŠµ Ko-E5 ë“± ì„ë² ë”© â†’ ë¼ë²¨ 0-4 ë¶„ë¥˜ê¸° íŒŒì¸íŠœë‹<br>2) `evaluate()`ë¡œ ê²€ì¦ F1 ì¶œë ¥<br>3) `export_onnx()`ë¡œ ì¶”ë¡ ìš© ONNX ì €ì¥ |
| **`chatbot_ui.py`** | `ChatApp` streamlipì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  Flask ê¸°ë°˜ web ui êµ¬ì„± | - ì„¸ì…˜ ìŠ¤í…Œì´íŠ¸ ê´€ë¦¬(`st.session_state["history"]`)<br>- FastAPI ë°±ì—”ë“œ í˜¸ì¶œ(`/answer`, `/predict`)<br>- ë‹µë³€Â·ì¶œì²˜ãƒ»Diff í•˜ì´ë¼ì´íŠ¸ ë Œë”ë§ |
| **`realtime_model.py`** | `FastAPI()` ì¸ìŠ¤í„´ìŠ¤<br>`router = APIRouter()`<br>`RAGService` í´ë˜ìŠ¤ | - `/predict` : 0-4 ë¼ë²¨ ë°˜í™˜<br>- `/answer` : ë¼ìš°íŒ…â†’RAGâ†’ë‹µë³€ JSON ìŠ¤íŠ¸ë¦¼<br>- `RAGService` ë‚´ë¶€ì—ì„œ **HybridRetriever Â· AnswerGenerator** í˜¸ì¶œ |

---

### 2-2. `crawlers/` â€” 5ì¢… ì •ë³´ ìˆ˜ì§‘ ë‹´ë‹¹

> ëª¨ë“  í¬ë¡¤ëŸ¬ëŠ” **ê³µí†µ ì¶”ìƒ í´ë˜ìŠ¤ `BaseCrawler`**(ë©”ì†Œë“œ `fetch()`, `parse()`, `save()`)ë¥¼ ìƒì†í•©ë‹ˆë‹¤.

| íŒŒì¼ | ì£¼ìš” í´ë˜ìŠ¤/í•¨ìˆ˜ | ì„¤ëª… |
|------|-----------------|------|
| `academic_calendar.py` | `AcademicCalendarCrawler(BaseCrawler)` | - í•™ì‚¬ì¼ì • **HTML í‘œ + PDF** ë‹¤ìš´ë¡œë“œ<br>- ì›”/ì¼/ì´ë²¤íŠ¸ íŒŒì‹± â†’ `data/raw/â€¦/academic.json` |
| `notices.py` | `NoticeCrawler(BaseCrawler)` | - `TODO_dir/cnu_crawler/data/links.txt`ì— ì •ì˜ëœ í•™ê³¼Â·ëŒ€í•™ **ê³µì§€ ê²Œì‹œíŒ**ì„ ìˆœíšŒ<br>- Generic ìŠ¤í¬ë ˆì´í¼ë¡œ ì œëª©Â·URLÂ·ê²Œì‹œì¼ë§Œ ì¶”ì¶œí•´ `data/raw/notices/â€¦/*.csv` ì €ì¥ |
| `shuttle_bus.py` | `ShuttleBusCrawler(BaseCrawler)` | - ì…”í‹€ ìš´í–‰í‘œâˆ™ë³€ê²½ ê³µì§€ í¬ë¡¤ë§<br>- ì‹œê°„í‘œ CSVÂ·ì´ë¯¸ì§€ OCR ì§€ì› |
| `graduation_req.py` | `GraduationRequirementCrawler(BaseCrawler)` | - ì¡¸ì—…ìš”ê±´ PDF/ì›¹ í…Œì´ë¸” ìŠ¤í¬ë©<br>- `compare_versions()`ë¡œ ì—°ë„ë³„ ì°¨ì´ ì¶”ì  |
| `meals.py` | `MealsCrawler(BaseCrawler)` | - í•™ì‹Â·êµì§ì›ì‹ë‹¨ **ì£¼ê°„ í‘œ** íŒŒì‹±<br>- ì‹ë‹¹Â·ì‹ì‚¬íƒ€ì…ë³„ ì¹¼ë¡œë¦¬/ì•ŒëŸ¬ì§€ ì •ë³´ ì •ê·œí™” |

---

### 2-3. `retrieval/` â€” ê²€ìƒ‰Â·í”„ë¡¬í”„íŠ¸ ë¡œì§

| íŒŒì¼ | ì£¼ìš” í´ë˜ìŠ¤/í•¨ìˆ˜ | ì„¤ëª… |
|------|-----------------|------|
| `build_index.py` | `build_bm25()`<br>`build_vector()`<br>`sync_indexes()` | - ê³µì§€Â·í•™ì‚¬ì¼ì • ë“±ì„ ë¡œë“œí•´ **BM25 & FAISS/Qdrant ë²¡í„° ì¸ë±ìŠ¤** ìƒì„±<br>- `sync_indexes()`ì—ì„œ ìµœì‹  íŒŒí‹°ì…˜ â€˜hot-swapâ€™ |
| `rag_pipeline.py` | `HybridRetriever`<br>`PromptBuilder`<br>`AnswerGenerator` | 1. **HybridRetriever**: `search_semantic() + search_bm25()` í›„ `recency_rerank()`<br>2. **PromptBuilder**: ì»¨í…ìŠ¤íŠ¸Â·ì§€ì¹¨ í¬í•¨ GPT ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±<br>3. **AnswerGenerator**: OpenAI API í˜¸ì¶œ, ìŠ¤íŠ¸ë¦¬ë° í† í° ì²˜ë¦¬ |

---

### 2-4. `utils/`

| íŒŒì¼ | êµ¬ì„± | ì„¤ëª… |
|------|------|------|
| `config.py` | `Settings`(Pydantic BaseSettings) | - DB ê²½ë¡œÂ·API í‚¤Â·ì¸ë±ìŠ¤ ìœ„ì¹˜ ë“± í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ |
| `logger.py` | `init_logger(name:str)` | - `loguru` ë˜í¼: ì‹œê°„Â·ë ˆë²¨Â·JSON ë¡œê·¸ ì˜µì…˜ |
| `__init__.py` | - | íŒ¨í‚¤ì§€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì´ˆê¸°í™” |

---

### 2-5. `evaluation/`

| íŒŒì¼ | ì£¼ìš” í•¨ìˆ˜ | ì„¤ëª… |
|------|-----------|------|
| `evaluate_rag.py` | `eval_recall_at_k()`<br>`eval_faithfulness()` | - **Ragas** ë©”íŠ¸ë¦­ í˜¸ì¶œ ë˜í¼<br>- ë¡œì»¬ ì¿¼ë¦¬ì…‹ìœ¼ë¡œ Retrieval / Generation í’ˆì§ˆ ìˆ˜ì§‘ |

---

## 3. `model/`

| íŒŒì¼ | ë‚´ìš© |
|------|------|
| `model.bin` | ì„ë² ë”© ëª¨ë¸ ê°€ì¤‘ì¹˜ (ì˜ˆ: KoE5 â†’ í•™ìŠµÂ·ì–‘ìí™”ëœ `sentence-transformers` í¬ë§·) |

---

## 4. `outputs/`

| íŒŒì¼ | ìš©ë„ |
|------|------|
| `cls_output.json` | ë¶„ë¥˜ê¸° ë°ëª¨Â·ë°°ì¹˜ ì¶”ë¡  ê²°ê³¼ ë¡œê·¸ |
| `chat_output.json` | Streamlit UI ëŒ€í™” ì„¸ì…˜ ê¸°ë¡ |
| `realtime_output.json` | FastAPI `/answer` í˜¸ì¶œ ë¡œê·¸ (ìš”ì²­Â·ì‘ë‹µÂ·latency) |

---

## 5. ë£¨íŠ¸ ìŠ¤í¬ë¦½íŠ¸Â·ë©”íƒ€íŒŒì¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `chatbot.sh` | â‘  **ëª¨ë“  í¬ë¡¤ëŸ¬ ì‹¤í–‰** â†’ â‘¡ `build_index.py` í˜¸ì¶œ â†’ â‘¢ FastAPI ì‹¤í–‰ (uvicorn) |
| `requirements.txt` | Python íŒ¨í‚¤ì§€ ê³ ì • ë²„ì „ ëª©ë¡ (`fastapi`, `streamlit`, `qdrant-client` â€¦) |
| `README.md` | **í”„ë¡œì íŠ¸ ê°œìš” ë° íŒŒì¼ ì„¤ëª…(ë³¸ ë¬¸ì„œ)** |

---

### ğŸ”— ëª¨ë“ˆ ê°„ ì˜ì¡´ íë¦„

crawlers/* â”€â–º data/raw/ â”
â”œâ”€â”€ build_index.py â”€â–º vector_store/
classifier.ipynb â”€â–º model/model.bin â”‚
â”‚
FastAPI(realtime_model.py) â—„â”€ rag_pipeline.py â—„â”€â”€â”€â”€â”€â”˜
Streamlit(chatbot_ui.py) â”€â”€â”€â”˜


- **í¬ë¡¤ëŸ¬**ê°€ ì›ë³¸ì„ ìˆ˜ì§‘í•´ `data/raw/` ì—…ë°ì´íŠ¸  
- `build_index.py` ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ë²¡í„°/BM25 ì¸ë±ìŠ¤ë¥¼ ì¬ìƒì„±  
- `realtime_model.py` ëŠ” REST API ì¸µì—ì„œ `rag_pipeline`ì„ í˜¸ì¶œ  
- Flask web UIÂ·CLIÂ·í…ŒìŠ¤íŠ¸ ëª¨ë‘ ê°™ì€ REST ì¸í„°í˜ì´ìŠ¤ë¥¼ ì†Œë¹„  

